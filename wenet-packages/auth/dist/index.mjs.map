{"version":3,"sources":["../src/verifyAdmin.ts","../src/verifyUser.ts"],"sourcesContent":["import { Request, Response, NextFunction } from \"express\";\r\nimport { verify } from 'jsonwebtoken';\r\n\r\nexport function verifyAdmin(req: Request, res: Response, next: NextFunction) {\r\n    const adminToken = req.cookies?.adminToken;\r\n  \r\n    if (!adminToken) {\r\n      return res.status(401).send(\"Admin JWT not found in the cookies\");\r\n    }\r\n  \r\n    const secret = process.env.JWT_SECRET || \"\";\r\n    if (!secret) {\r\n      return res.status(500).send(\"JWT secret not found in the env\");\r\n    }\r\n  \r\n    try {\r\n      const decoded: any = verify(adminToken, secret);\r\n      if (!decoded?.role || decoded.role != \"wenet-admin\") {\r\n        return res.status(401).send(\"Invalid admin JWT\");\r\n      }\r\n  \r\n      next();\r\n    } catch (err: any) {\r\n      return res.status(401).send(\"Invalid admin JWT\");\r\n    }\r\n  }","import { Request, Response, NextFunction } from \"express\";\r\nimport { verify } from \"jsonwebtoken\";\r\n\r\nexport function verifyUser(\r\n  req: any,\r\n  res: Response,\r\n  next: NextFunction\r\n) {\r\n  const userToken = req.cookies?.token;\r\n  if (!userToken) {\r\n    return res.status(401).send(\"JWT not found in the cookies\");\r\n  }\r\n\r\n  const secret = process.env.JWT_SECRET || \"\";\r\n  if (!secret) {\r\n    return res.status(500).json(\"JWT secret not found in the env\");\r\n  }\r\n\r\n  try {\r\n    const decoded: any = verify(userToken, secret);\r\n\r\n    req.user = decoded?.userData;\r\n    if (!decoded?.role || decoded.role != \"wenet-user\") {\r\n      return res.status(401).send(\"Invalid JWT\");\r\n    }\r\n\r\n    next();\r\n  } catch (err: any) {\r\n    return res.status(401).send(\"Invalid JWT\");\r\n  }\r\n}\r\n"],"mappings":";AACA,SAAS,cAAc;AAEhB,SAAS,YAAY,KAAc,KAAe,MAAoB;AAH7E;AAII,QAAM,cAAa,SAAI,YAAJ,mBAAa;AAEhC,MAAI,CAAC,YAAY;AACf,WAAO,IAAI,OAAO,GAAG,EAAE,KAAK,oCAAoC;AAAA,EAClE;AAEA,QAAM,SAAS,QAAQ,IAAI,cAAc;AACzC,MAAI,CAAC,QAAQ;AACX,WAAO,IAAI,OAAO,GAAG,EAAE,KAAK,iCAAiC;AAAA,EAC/D;AAEA,MAAI;AACF,UAAM,UAAe,OAAO,YAAY,MAAM;AAC9C,QAAI,EAAC,mCAAS,SAAQ,QAAQ,QAAQ,eAAe;AACnD,aAAO,IAAI,OAAO,GAAG,EAAE,KAAK,mBAAmB;AAAA,IACjD;AAEA,SAAK;AAAA,EACP,SAAS,KAAU;AACjB,WAAO,IAAI,OAAO,GAAG,EAAE,KAAK,mBAAmB;AAAA,EACjD;AACF;;;ACxBF,SAAS,UAAAA,eAAc;AAEhB,SAAS,WACd,KACA,KACA,MACA;AAPF;AAQE,QAAM,aAAY,SAAI,YAAJ,mBAAa;AAC/B,MAAI,CAAC,WAAW;AACd,WAAO,IAAI,OAAO,GAAG,EAAE,KAAK,8BAA8B;AAAA,EAC5D;AAEA,QAAM,SAAS,QAAQ,IAAI,cAAc;AACzC,MAAI,CAAC,QAAQ;AACX,WAAO,IAAI,OAAO,GAAG,EAAE,KAAK,iCAAiC;AAAA,EAC/D;AAEA,MAAI;AACF,UAAM,UAAeA,QAAO,WAAW,MAAM;AAE7C,QAAI,OAAO,mCAAS;AACpB,QAAI,EAAC,mCAAS,SAAQ,QAAQ,QAAQ,cAAc;AAClD,aAAO,IAAI,OAAO,GAAG,EAAE,KAAK,aAAa;AAAA,IAC3C;AAEA,SAAK;AAAA,EACP,SAAS,KAAU;AACjB,WAAO,IAAI,OAAO,GAAG,EAAE,KAAK,aAAa;AAAA,EAC3C;AACF;","names":["verify"]}